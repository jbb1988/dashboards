(()=>{"use strict";const e="https://mars-contracts.vercel.app";function t(t,o,n="info"){Office.context.ui.displayDialogAsync(`${e}/word-addin/notification.html?title=${encodeURIComponent(t)}&message=${encodeURIComponent(o)}&type=${n}`,{height:20,width:30},e=>{e.status===Office.AsyncResultStatus.Succeeded&&setTimeout(()=>e.value.close(),3e3)})}Office.onReady(()=>{console.log("MARS Commands ready")}),globalThis.analyzeDocument=async function(o){try{const n=localStorage.getItem("mars_token");if(!n)return t("Authentication Required","Please sign in using the Review Panel first.","error"),void o.completed();const i=await async function(){return new Promise((e,t)=>{Word.run(async t=>{const o=t.document.body;o.load("text"),await t.sync(),e(o.text)}).catch(t)})}();if(!i||i.trim().length<100)return t("Analysis Error","Document appears to be empty or too short to analyze.","error"),void o.completed();t("Analyzing...","Please wait while we analyze your document.");const a=await fetch(`${e}/api/word-addin/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({document_text:i})});if(!a.ok)throw new Error("Analysis failed");const s=await a.json();await async function(e){e&&0!==e.length&&await Word.run(async t=>{for(const o of e)if(o.location){const e=t.document.body.search(o.location.substring(0,100),{matchCase:!1,matchWholeWord:!1});if(e.load("items"),await t.sync(),e.items.length>0){const t=e.items[0];switch(o.severity){case"high":t.font.highlightColor="#FECACA";break;case"medium":t.font.highlightColor="#FED7AA";break;case"low":t.font.highlightColor="#FEF08A"}}}await t.sync()})}(s.risks);t("Analysis Complete",`Found ${s.risks?.length||0} issues. Risk level: ${s.risk_level||"unknown"}. Open Review Panel for details.`,"info")}catch(e){console.error("Analysis error:",e),t("Analysis Failed","An error occurred during analysis. Please try again.","error")}o.completed()},globalThis.insertClauseAtSelection=async function(e){await Word.run(async t=>{t.document.getSelection().insertText(e,Word.InsertLocation.replace),await t.sync()})},globalThis.clearHighlights=async function(){await Word.run(async e=>{e.document.body.font.highlightColor="NoHighlight",await e.sync()})}})();